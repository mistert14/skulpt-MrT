/*
 * Flot plugin to order bars side by side.
 *
 * Released under the MIT license by Benjamin BUFFET, 20-Sep-2010.
 * Modifications made by Steven Hall <github.com/emmerich>, 01-May-2013.
 *
 * This plugin is an alpha version.
 *
 * To activate the plugin you must specify the parameter "order" for the specific serie :
 *
 *  $.plot($("#placeholder"), [{ data: [ ... ], bars :{ order = null or integer }])
 *
 * If 2 series have the same order param, they are ordered by the position in the array;
 *
 * The plugin adjust the point by adding a value depanding of the barwidth
 * Exemple for 3 series (barwidth : 0.1) :
 *
 *          first bar décalage : -0.15
 *          second bar décalage : -0.05
 *          third bar décalage : 0.05
 *
 */// INFO: decalage/decallage is French for gap. It's used to denote the spacing applied to each
// bar.
(function(a){function b(a){function i(a,d,f){var g=null;if(j(d)){q(d),k(a),m(a),p(d);if(c>=2){var i=r(d),l=0,n=s();typeof h[d.bars.order]=="undefined"&&(t(i)?h[d.bars.order]=-1*u(b,i-1,Math.floor(c/2)-1)-n:h[d.bars.order]=u(b,Math.ceil(c/2),i-2)+n+e*2),l=h[d.bars.order],g=v(f,d,l),f.points=g}}return g}function j(a){return a.bars!=null&&a.bars.show&&a.bars.order!=null}function k(a){var b=g?a.getPlaceholder().innerHeight():a.getPlaceholder().innerWidth(),c=g?l(a.getData(),1):l(a.getData(),0),d=c[1]-c[0];f=d/b}function l(a,b){var c=new Array;for(var d=0;d<a.length;d++)c[0]=a[d].data[0][b],c[1]=a[d].data[a[d].data.length-1][b];return c}function m(a){b=n(a.getData()),c=b.length}function n(a){var b=new Array,c=[];for(var d=0;d<a.length;d++)a[d].bars.order!=null&&a[d].bars.show&&c.indexOf(a[d].bars.order)<0&&(c.push(a[d].bars.order),b.push(a[d]));return b.sort(o)}function o(a,b){var c=a.bars.order,d=b.bars.order;return c<d?-1:c>d?1:0}function p(a){d=typeof a.bars.lineWidth!="undefined"?a.bars.lineWidth:2,e=d*f}function q(a){a.bars.horizontal&&(g=!0)}function r(a){var c=0;for(var d=0;d<b.length;++d)if(a==b[d]){c=d;break}return c+1}function s(){var a=0;return c%2!=0&&(a=b[Math.ceil(c/2)].bars.barWidth/2),a}function t(a){return a<=Math.ceil(c/2)}function u(a,b,c){var d=0;for(var f=b;f<=c;f++)d+=a[f].bars.barWidth+e*2;return d}function v(a,b,c){var d=a.pointsize,e=a.points,f=0;for(var h=g?1:0;h<e.length;h+=d)e[h]+=c,b.data[f][3]=e[h],f++;return e}var b,c,d,e,f=1,g=!1,h={};a.hooks.processDatapoints.push(i)}var c={series:{bars:{order:null}}};a.plot.plugins.push({init:b,options:c,name:"orderBars",version:"0.2"})})(jQuery);